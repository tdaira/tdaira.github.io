<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Benchmarks - bleRPC</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="header-inner">
      <a href="." class="logo">bleRPC</a>
      <button class="hamburger" onclick="toggleMenu()">&#9776;</button>
      <nav>
        <a href=".">Overview</a>
        <a href="getting-started.html">Getting Started</a>
        <a href="benchmarks.html">Benchmarks</a>
        <a href="protocol.html">Protocol</a>
        <a href="repositories.html">Repositories</a>
        <a href="https://github.com/tdaira/tdaira.github.io" class="github-link" title="Edit this site on GitHub"><svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a>
        <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()"></button>
      </nav>
    </div>
  </header>

  <main>
    <h1>Benchmark Results</h1>
    <p>All benchmarks were performed against a <strong>nRF54L15 DK</strong> peripheral running bleRPC firmware. MTU was negotiated to 247 bytes. Connection interval varies by platform.</p>

    <h2>Throughput Comparison</h2>
    <div class="grid">
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">Python (macOS)</p>
        <div class="bench-value">30.3</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 15ms</span></p>
      </div>
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">iOS (iPhone 16)</p>
        <div class="bench-value">31.7</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 30ms</span></p>
      </div>
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">Android (Pixel 5)</p>
        <div class="bench-value">56.7</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 30ms</span></p>
      </div>
    </div>

    <h2>Detailed Results by Platform</h2>

    <h3>Python Central (macOS, bleak)</h3>
    <p>Connection interval: 15ms (macOS negotiation)</p>
    <table>
      <thead><tr><th>Test</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>30.3 KB/s</strong></td><td>10x 8192 bytes, 273 ms/call</td></tr>
        <tr><td>flash_read_overhead</td><td><strong>34.2 ms/call</strong></td><td>1 byte x 20 calls</td></tr>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_max_length</td><td><span class="badge badge-green">PASS</span></td><td>256-char string</td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td><td>8192 bytes</td></tr>
        <tr><td>multi_container_echo</td><td><span class="badge badge-green">PASS</span></td><td>Multi-container request</td></tr>
      </tbody>
    </table>

    <h3>iOS Central (iPhone 16, CoreBluetooth)</h3>
    <p>Connection interval: 30ms (iOS negotiation)</p>
    <table>
      <thead><tr><th>Test</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>31.7 KB/s</strong></td><td>10x 8192 bytes, 252.0 ms/call</td></tr>
        <tr><td>flash_read_overhead</td><td><strong>62.3 ms/call</strong></td><td>1 byte x 20 calls</td></tr>
        <tr><td>echo_roundtrip</td><td><strong>60.0 ms/call</strong></td><td>50 calls</td></tr>
        <tr><td>data_write_throughput</td><td><strong>3.3 KB/s</strong></td><td>200 bytes x 20 calls, 60.0 ms/call</td></tr>
        <tr><td>counter_stream (P&rarr;C)</td><td><strong>6.1 ms/item</strong></td><td>20 items in 122ms</td></tr>
        <tr><td>counter_upload (C&rarr;P)</td><td><strong>4.5 ms/item</strong></td><td>20 items in 90ms</td></tr>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td><td>8192 bytes</td></tr>
        <tr><td>data_write</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>counter_stream</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
        <tr><td>counter_upload</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
      </tbody>
    </table>

    <h3>Android Central (Pixel 5)</h3>
    <p>Connection interval: 30ms (Android negotiation)</p>
    <table>
      <thead><tr><th>Test</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>56.7 KB/s</strong></td><td>10x 8192 bytes, 141.0 ms/call</td></tr>
        <tr><td>flash_read_overhead</td><td><strong>90.1 ms/call</strong></td><td>1 byte x 20 calls</td></tr>
        <tr><td>echo_roundtrip</td><td><strong>62.1 ms/call</strong></td><td>50 calls</td></tr>
        <tr><td>data_write_throughput</td><td><strong>3.2 KB/s</strong></td><td>200 bytes x 20 calls, 61.8 ms/call</td></tr>
        <tr><td>counter_stream (P&rarr;C)</td><td><strong>3.2 ms/item</strong></td><td>20 items in 64ms</td></tr>
        <tr><td>counter_upload (C&rarr;P)</td><td><strong>5.5 ms/item</strong></td><td>20 items in 110ms</td></tr>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td><td>8192 bytes</td></tr>
        <tr><td>data_write</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>counter_stream</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
        <tr><td>counter_upload</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
      </tbody>
    </table>

    <h2>Performance Notes</h2>
    <div class="card">
      <h3>Connection Interval Impact</h3>
      <p>The connection interval (CI) is the primary factor in round-trip latency. Each request&ndash;response cycle requires at least 2 connection events:</p>
      <ul>
        <li><strong>macOS (bleak)</strong>: CI = 15ms &rarr; ~30ms round-trip</li>
        <li><strong>iOS (iPhone 16)</strong>: CI = 30ms &rarr; ~60ms round-trip</li>
        <li><strong>Android (Pixel 5)</strong>: CI = 30ms &rarr; ~60ms round-trip, but highest throughput due to more packets per connection event</li>
      </ul>
      <p>The peripheral advertises preferred CI of 15&ndash;30ms (<code>PREF_MIN_INT=12, PREF_MAX_INT=24</code>). The actual CI is determined by the Central&rsquo;s OS.</p>
    </div>
    <div class="card">
      <h3>Throughput Optimizations</h3>
      <ul>
        <li><strong>nanopb FT_CALLBACK</strong>: Streams flash data directly into protobuf encoding, saving 4KB static RAM</li>
        <li><strong>Zero-copy response</strong>: Protobuf response is encoded directly at the container header offset</li>
        <li><strong>No inter-packet delay</strong>: Containers are sent back-to-back</li>
        <li><strong>Max 8KB per flash read</strong>: Optimal balance between latency and throughput</li>
      </ul>
    </div>
  </main>

  <footer>
    <p>bleRPC is licensed under <a href="https://www.gnu.org/licenses/lgpl-3.0.html">LGPL-3.0</a>. &copy; 2025 tdaira.</p>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
