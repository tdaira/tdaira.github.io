<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Benchmarks - bleRPC</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header></header>

  <main>
    <h1>Benchmark Results</h1>
    <p>All benchmarks were performed against a <strong>nRF54L15 DK</strong> peripheral running bleRPC firmware with <strong>E2E encryption enabled</strong> (AES-128-GCM). MTU was negotiated to 247 bytes. Connection interval varies by platform.</p>

    <h2>Throughput Comparison</h2>
    <div class="grid">
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">Python (macOS)</p>
        <div class="bench-value">30.3</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 15ms</span></p>
      </div>
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">iOS (iPhone 16)</p>
        <div class="bench-value">32.1</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 30ms</span></p>
      </div>
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">Android (Pixel 5)</p>
        <div class="bench-value">59.0</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 30ms</span></p>
      </div>
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">React Native iOS (iPhone 16)</p>
        <div class="bench-value">28.2</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 30ms</span></p>
      </div>
      <div class="card" style="text-align:center">
        <p style="margin-bottom:0.3rem">React Native Android (Pixel 5)</p>
        <div class="bench-value">41.0</div>
        <div class="bench-unit">KB/s flash read</div>
        <p style="margin-top:0.5rem"><span class="badge badge-blue">CI: 30ms</span></p>
      </div>
    </div>

    <h2>Detailed Results by Platform</h2>

    <h3>Python Central (macOS, bleak)</h3>
    <p>Connection interval: 15ms (macOS negotiation) &mdash; <a href="https://github.com/tdaira/blerpc/blob/main/central_py/tests/test_integration.py">test code</a></p>
    <table>
      <thead><tr><th>Benchmark</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>30.3 KB/s</strong></td><td>10x 8192 bytes, 264.2 ms/call</td></tr>
        <tr><td>flash_read_overhead</td><td><strong>60.1 ms/call</strong></td><td>1 byte x 20 calls</td></tr>
        <tr><td>echo_roundtrip</td><td><strong>60.6 ms/call</strong></td><td>50 calls</td></tr>
        <tr><td>data_write_throughput</td><td><strong>3.3 KB/s</strong></td><td>200 bytes x 20 calls, 59.9 ms/call</td></tr>
        <tr><td>counter_stream (P&rarr;C)</td><td><strong>5.8 ms/item</strong></td><td>20 items in 117 ms</td></tr>
        <tr><td>counter_upload (C&rarr;P)</td><td><strong>7.4 ms/item</strong></td><td>20 items in 147 ms</td></tr>
      </tbody>
    </table>
    <table>
      <thead><tr><th>Functional Test</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_max_length</td><td><span class="badge badge-green">PASS</span></td><td>256-char string</td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td><td>16 bytes</td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td><td>8192 bytes</td></tr>
        <tr><td>data_write_basic</td><td><span class="badge badge-green">PASS</span></td><td>1024 bytes</td></tr>
        <tr><td>data_write_8kb</td><td><span class="badge badge-green">PASS</span></td><td>8192 bytes</td></tr>
        <tr><td>multi_container_echo</td><td><span class="badge badge-green">PASS</span></td><td>250-char string</td></tr>
        <tr><td>counter_stream</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
        <tr><td>counter_stream_large</td><td><span class="badge badge-green">PASS</span></td><td>20 items</td></tr>
        <tr><td>counter_upload</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
        <tr><td>counter_upload_large</td><td><span class="badge badge-green">PASS</span></td><td>20 items</td></tr>
      </tbody>
    </table>

    <h3>iOS Central (iPhone 16, CoreBluetooth)</h3>
    <p>Connection interval: 30ms (iOS negotiation) &mdash; <a href="https://github.com/tdaira/blerpc/blob/main/central_ios/BlerpcCentral/Test/TestRunner.swift">test code</a></p>
    <table>
      <thead><tr><th>Benchmark</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>32.1 KB/s</strong></td><td>10x 8192 bytes, 249.0 ms/call</td></tr>
        <tr><td>flash_read_overhead</td><td><strong>62.3 ms/call</strong></td><td>1 byte x 20 calls</td></tr>
        <tr><td>echo_roundtrip</td><td><strong>60.0 ms/call</strong></td><td>50 calls</td></tr>
        <tr><td>data_write_throughput</td><td><strong>3.3 KB/s</strong></td><td>200 bytes x 20 calls, 60.0 ms/call</td></tr>
        <tr><td>counter_stream (P&rarr;C)</td><td><strong>6.1 ms/item</strong></td><td>20 items in 121 ms</td></tr>
        <tr><td>counter_upload (C&rarr;P)</td><td><strong>4.5 ms/item</strong></td><td>20 items in 91 ms</td></tr>
      </tbody>
    </table>
    <table>
      <thead><tr><th>Functional Test</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td><td>8192 bytes</td></tr>
        <tr><td>data_write</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>counter_stream</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
        <tr><td>counter_upload</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
      </tbody>
    </table>

    <h3>Android Central (Pixel 5)</h3>
    <p>Connection interval: 30ms (Android negotiation) &mdash; <a href="https://github.com/tdaira/blerpc/blob/main/central_android/app/src/main/java/com/blerpc/android/test/TestRunner.kt">test code</a></p>
    <table>
      <thead><tr><th>Benchmark</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>59.0 KB/s</strong></td><td>10x 8192 bytes, 135.7 ms/call</td></tr>
        <tr><td>flash_read_overhead</td><td><strong>90.4 ms/call</strong></td><td>1 byte x 20 calls</td></tr>
        <tr><td>echo_roundtrip</td><td><strong>62.2 ms/call</strong></td><td>50 calls</td></tr>
        <tr><td>data_write_throughput</td><td><strong>3.2 KB/s</strong></td><td>200 bytes x 20 calls, 60.3 ms/call</td></tr>
        <tr><td>counter_stream (P&rarr;C)</td><td><strong>3.7 ms/item</strong></td><td>20 items in 73 ms</td></tr>
        <tr><td>counter_upload (C&rarr;P)</td><td><strong>5.1 ms/item</strong></td><td>20 items in 101 ms</td></tr>
      </tbody>
    </table>
    <table>
      <thead><tr><th>Functional Test</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td><td></td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td><td>8192 bytes</td></tr>
        <tr><td>data_write</td><td><span class="badge badge-green">PASS</span></td><td>64 bytes</td></tr>
        <tr><td>counter_stream</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
        <tr><td>counter_upload</td><td><span class="badge badge-green">PASS</span></td><td>5 items</td></tr>
      </tbody>
    </table>

    <h3>React Native iOS (iPhone 16, react-native-ble-plx)</h3>
    <p>Connection interval: 30ms (iOS negotiation) &mdash; <a href="https://github.com/tdaira/blerpc/blob/main/central_rn/src/test/TestRunner.ts">test code</a></p>
    <table>
      <thead><tr><th>Benchmark</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>28.2 KB/s</strong></td><td>10x 8192 bytes</td></tr>
        <tr><td>echo_roundtrip</td><td><strong>60.1 ms/call</strong></td><td>50 calls</td></tr>
        <tr><td>data_write_throughput</td><td><strong>3.3 KB/s</strong></td><td>200 bytes x 20 calls</td></tr>
      </tbody>
    </table>
    <table>
      <thead><tr><th>Functional Test</th><th>Result</th></tr></thead>
      <tbody>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>data_write</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>counter_stream</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>counter_upload</td><td><span class="badge badge-green">PASS</span></td></tr>
      </tbody>
    </table>

    <h3>React Native Android (Pixel 5, react-native-ble-plx)</h3>
    <p>Connection interval: 30ms (Android negotiation) &mdash; <a href="https://github.com/tdaira/blerpc/blob/main/central_rn/src/test/TestRunner.ts">test code</a></p>
    <table>
      <thead><tr><th>Benchmark</th><th>Result</th><th>Details</th></tr></thead>
      <tbody>
        <tr><td>flash_read_throughput</td><td><strong>41.0 KB/s</strong></td><td>10x 8192 bytes, 195.1 ms/call</td></tr>
        <tr><td>flash_read_overhead</td><td><strong>75.2 ms/call</strong></td><td>1 byte x 20 calls</td></tr>
        <tr><td>echo_roundtrip</td><td><strong>85.2 ms/call</strong></td><td>50 calls</td></tr>
        <tr><td>data_write_throughput</td><td><strong>2.3 KB/s</strong></td><td>200 bytes x 20 calls, 85.7 ms/call</td></tr>
        <tr><td>counter_stream (P&rarr;C)</td><td><strong>6.0 ms/item</strong></td><td>20 items in 121 ms</td></tr>
        <tr><td>counter_upload (C&rarr;P)</td><td><strong>17.5 ms/item</strong></td><td>20 items in 350 ms</td></tr>
      </tbody>
    </table>
    <table>
      <thead><tr><th>Functional Test</th><th>Result</th></tr></thead>
      <tbody>
        <tr><td>echo_basic</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>echo_empty</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>flash_read_basic</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>flash_read_8kb</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>data_write</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>counter_stream</td><td><span class="badge badge-green">PASS</span></td></tr>
        <tr><td>counter_upload</td><td><span class="badge badge-green">PASS</span></td></tr>
      </tbody>
    </table>

    <h2>Performance Notes</h2>
    <div class="card">
      <h3>Connection Interval Impact</h3>
      <p>The connection interval (CI) is the primary factor in round-trip latency. Each request&ndash;response cycle requires at least 2 connection events:</p>
      <ul>
        <li><strong>macOS (bleak)</strong>: CI = 15ms &rarr; ~30ms round-trip</li>
        <li><strong>iOS (iPhone 16)</strong>: CI = 30ms &rarr; ~60ms round-trip</li>
        <li><strong>Android (Pixel 5)</strong>: CI = 30ms &rarr; ~60ms round-trip, but highest throughput due to more packets per connection event</li>
        <li><strong>React Native</strong>: Same BLE stack as native (CoreBluetooth on iOS, Android BLE on Android), but the JS bridge adds ~10&ndash;20ms overhead per round-trip compared to native clients</li>
      </ul>
      <p>The peripheral advertises preferred CI of 15&ndash;30ms (<code>PREF_MIN_INT=12, PREF_MAX_INT=24</code>). The actual CI is determined by the Central&rsquo;s OS.</p>
    </div>
    <div class="card">
      <h3>Encryption Overhead</h3>
      <p>E2E encryption adds <strong>20 bytes</strong> per transaction (4-byte counter + 16-byte AES-GCM tag). For large payloads (8 KB), this overhead is negligible (&lt;0.3%). The AES-128-GCM encryption/decryption itself is hardware-accelerated on modern mobile devices and takes &lt;1ms even for 8 KB payloads.</p>
    </div>
    <div class="card">
      <h3>Throughput Optimizations</h3>
      <ul>
        <li><strong>nanopb FT_CALLBACK</strong>: Streams flash data directly into protobuf encoding, saving 4KB static RAM</li>
        <li><strong>Zero-copy response</strong>: Protobuf response is encoded directly at the container header offset</li>
        <li><strong>No inter-packet delay</strong>: Containers are sent back-to-back</li>
        <li><strong>Max 8KB per flash read</strong>: Optimal balance between latency and throughput</li>
      </ul>
    </div>
  </main>

  <footer></footer>

  <script src="script.js"></script>
</body>
</html>
